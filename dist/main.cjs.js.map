{"version":3,"file":"main.cjs.js","sources":["../node_modules/@babel/runtime/helpers/arrayLikeToArray.js","../node_modules/@babel/runtime/helpers/arrayWithoutHoles.js","../node_modules/@babel/runtime/helpers/iterableToArray.js","../node_modules/@babel/runtime/helpers/unsupportedIterableToArray.js","../node_modules/@babel/runtime/helpers/nonIterableSpread.js","../node_modules/@babel/runtime/helpers/toConsumableArray.js","../node_modules/@babel/runtime/helpers/classCallCheck.js","../node_modules/@babel/runtime/helpers/defineProperty.js","../src/main.ts"],"sourcesContent":["function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nmodule.exports = _arrayLikeToArray;","var arrayLikeToArray = require(\"./arrayLikeToArray\");\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}\n\nmodule.exports = _arrayWithoutHoles;","function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}\n\nmodule.exports = _iterableToArray;","var arrayLikeToArray = require(\"./arrayLikeToArray\");\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}\n\nmodule.exports = _unsupportedIterableToArray;","function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nmodule.exports = _nonIterableSpread;","var arrayWithoutHoles = require(\"./arrayWithoutHoles\");\n\nvar iterableToArray = require(\"./iterableToArray\");\n\nvar unsupportedIterableToArray = require(\"./unsupportedIterableToArray\");\n\nvar nonIterableSpread = require(\"./nonIterableSpread\");\n\nfunction _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}\n\nmodule.exports = _toConsumableArray;","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;","// from : https://github.com/expo/expo/tree/master/packages/expo-sqlite/src\nimport { \n    Query,\n    Window,\n    Database,\n    SQLiteCallback,\n    // ResultSet,\n    ResultSetRow,\n    SQLTransaction,\n    SQLResultSet,\n    SQLError,\n    TxCallback,\n    TxSuccessCallback,\n    TxErrorCallback,\n    ResultSetError,\n    WebSQLDatabase \n} from './SQLite.types';\n// import { Window, Database } from './WebSQL.types';\n\nimport { PouchDBRow } from './PouchDB.types';\n\nexport class OuchDB {\n    db: Database;\n\n    constructor(dbName: string) {\n        // SOQ/12709074/how-do-you-explicitly-set-a-new-property-on-window-in-typescript\n        this.db = window['openDatabase'](dbName, '1', 'foo', 2 * 1024 * 1024)\n    }\n\n    // getDBTx = (dbName: string) => \n    //     window.openDatabase(dbName, '1', 'foo', 2 * 1024 * 1024)\n    //         .transaction(tx => this.dbTx = tx);\n\n    getAllRows = (tx: SQLTransaction, table: string): Promise<TxCallback> => \n        new Promise((resolve, reject) =>   \n            tx.executeSql(\n                `SELECT * FROM \"${table}\"`, \n                [], \n                (tx, res) => resolve([tx, res]),\n                (tx, err) => reject([tx, err])\n            )\n        );\n\n    mapDocRows = (res: SQLResultSet): ResultSetRow[] => \n        Object.keys(res.rows).map(_ => res.rows[_]);\n    \n    getRevInt =(inRev: string): number => \n        parseInt(inRev.split('-')[0]);\n\n    compareDocs = (leftDoc, rightDoc) =>\n        leftDoc.doc_id !== rightDoc.doc_id \n            ? true \n            : leftDoc == rightDoc || \n               this.getRevInt(leftDoc.rev) > this.getRevInt(rightDoc.rev);\n\n    filterOldRevs = (origSeq: ResultSetRow[]): ResultSetRow[] => \n        origSeq.reduce<ResultSetRow[]>((acc, iter) => \n            ([...acc, iter].filter(x => this.compareDocs(x, iter))), []);\n\n    deleteRev = (tx, doc) =>  new Promise((resolve, reject) => \n            tx.executeSql(\n                `DELETE FROM \"by-sequence\" WHERE doc_id = \"${doc.doc_id}\" AND rev = \"${doc.rev}\"`,\n                [],\n                () => resolve(),\n                (err) => reject(err)\n            )\n    );\n  \n    deleteDiff = (tx, origSeq, filterSeq) => \n        origSeq\n        .filter(x => !filterSeq.includes(x))\n        .forEach(x => this.deleteRev(tx, x));\n\n    getTables = (tx: SQLTransaction): Promise<TxCallback> =>  new Promise((resolve, reject) => \n            tx.executeSql(\n                'SELECT tbl_name from sqlite_master WHERE type = \"table\"',\n                [],\n                (tx, res) => resolve([tx, res]),\n                (tx, err) => reject([tx, err])\n            )\n    );\n\n    drobTable = (tx: SQLTransaction, tableName: string) => new Promise((resolve, reject) =>\n        tx.executeSql(\n            `DROP TABLE \"${tableName}\"`,\n            [],\n            (tx, res) => {\n                console.log(`DROOOOP'D ${tableName}`);\n                resolve([tx, res]);\n            },\n            (tx, err) => {\n                console.log(`NOOOOO ${tableName}`, err);\n                reject([tx, err]);\n            }\n            )\n        );\n\n    dropAllTablesExcept = (tx: SQLTransaction) =>\n        Promise.all(\n            [\n            'attach-store',\n            'local-store',\n            'attach-seq-store',\n            'document-store',\n            'metadata-store'\n        ].map(x => this.drobTable(tx, x))\n        ).then(() => {\n            console.log('DROPPED IT LIKE IT\\'S HOT!');\n            return Promise.resolve(tx);\n        });\n};"],"names":["OuchDB","dbName","tx","table","Promise","resolve","reject","executeSql","res","err","Object","keys","rows","map","_","inRev","parseInt","split","leftDoc","rightDoc","doc_id","getRevInt","rev","origSeq","reduce","acc","iter","filter","x","compareDocs","doc","filterSeq","includes","forEach","deleteRev","tableName","console","log","all","drobTable","then","db","window"],"mappings":"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"}